<script src="https://cdn.auth0.com/js/auth0-spa-js/1.22/auth0-spa-js.production.js"></script>
<!-- Boutons d'inscription et de connexion -->
<button id="login">Connexion</button>
<button id="logout" style="display:none;">Déconnexion</button>
<div id="profile" style="display:none;">
  <h2>Bienvenue <span id="username"></span></h2>
</div>

<script>
  const auth0 = await createAuth0Client({
    domain: "https://luilautre.eu.auth0.com/api/v2/",
    clientId: "WUrGporjmFSfLBr3va3Bl0LJNuIR1O0Q",
    cacheLocation: "localstorage"
  });

  // Afficher ou cacher les boutons
  async function updateUI() {
    const isAuthenticated = await auth0.isAuthenticated();
    document.getElementById('login').style.display = isAuthenticated ? 'none' : 'inline-block';
    document.getElementById('logout').style.display = isAuthenticated ? 'inline-block' : 'none';
    document.getElementById('profile').style.display = isAuthenticated ? 'block' : 'none';

    if (isAuthenticated) {
      const user = await auth0.getUser();
      document.getElementById('username').textContent = user.name || user.email;
    }
  }

  // Connexion
  document.getElementById('login').addEventListener('click', () => {
    auth0.loginWithRedirect();
  });

  // Déconnexion
  document.getElementById('logout').addEventListener('click', () => {
    auth0.logout({ returnTo: window.location.origin });
  });

  // Gérer le retour de la connexion
  window.onload = async () => {
    if (window.location.search.includes("code=") && window.location.search.includes("state=")) {
      await auth0.handleRedirectCallback();
      window.history.replaceState({}, document.title, "/");
    }
    updateUI();
  };
</script>
